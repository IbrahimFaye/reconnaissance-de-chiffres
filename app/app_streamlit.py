import streamlit as st
import numpy as np
from PIL import Image
import tensorflow as tf
from streamlit_drawable_canvas import st_canvas

# Charger le mod√®le
model = tf.keras.models.load_model('../saved_models/mnist_cnn.h5')

st.title("üé® Reconnaissance de Chiffres MNIST avec CNN")
st.write("Dessine un chiffre (0-9) dans la zone ci-dessous et le mod√®le le reconna√Ætra.")

# Param√®tres du canvas
canvas_size = 280
stroke_width = st.slider("√âpaisseur du trait :", 5, 25, 15)

canvas_result = st_canvas(
    fill_color="black",
    stroke_width=stroke_width,
    stroke_color="white",
    background_color="black",
    width=canvas_size,
    height=canvas_size,
    drawing_mode="freedraw",
    key="canvas",
)

# Bouton pour pr√©dire
if st.button("Pr√©dire"):
    if canvas_result.image_data is not None:
        # R√©cup√©rer l‚Äôimage du canvas
        img = canvas_result.image_data.astype("uint8")
        img = Image.fromarray(img).convert("L").resize((28,28))

        # Pr√©parer l'image pour le mod√®le
        img_array = np.array(img).reshape(1,28,28,1)/255.0

        # Pr√©diction
        pred = model.predict(img_array)
        predicted_digit = np.argmax(pred)

        st.write(f"### ‚úÖ Le mod√®le pr√©dit : **{predicted_digit}**")
        st.image(img.resize((140,140)), caption="Image entr√©e", width=140)
